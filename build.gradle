plugins {
    id 'java'
}

sourceCompatibility = JavaVersion.toVersion(project.java_version)
targetCompatibility = JavaVersion.toVersion(project.java_version)

archivesBaseName = "kalesutilities"
group = "com.kale_ko"
version = project.plugin_version

def projects = [":Shared", ":Spigot", ":Bungee"]

projects.collect {
    project(it).configurations {
        depencancy
        depencancy.canBeResolved = true

        compileOnly {
            extendsFrom depencancy
        }
    }
}

tasks.register("buildAll", Jar) {
    sourceCompatibility = JavaVersion.toVersion(project.java_version)
    targetCompatibility = JavaVersion.toVersion(project.java_version)

    dependsOn projects.collect{ it + ":build" }

    duplicatesStrategy = "exclude"

    destinationDirectory = file("\\")
    from files(projects.collect { project(it).sourceSets.main.output })
    from files(projects.collect { project(it).configurations.depencancy.collect { it.isDirectory() ? it : zipTree(it) } })
}